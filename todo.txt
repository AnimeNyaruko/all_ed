# Danh sách việc cần làm - Dự án Trình soạn thảo Toán LaTeX

## Tối ưu hóa hiệu năng

### Lag khi Thay đổi kích thước (lambai.tsx / ResizableBox)

*   **Trạng thái hiện tại:** Đã áp dụng Debounce (100ms) cho trình xử lý `onResize`. Hiệu năng đã cải thiện nhưng người dùng cảm thấy cần thay đổi thêm. Đã thử `onResizeStop` trước đây nhưng vẫn cảm thấy có lag.
*   **Vấn đề còn lại:** Ngay cả khi cập nhật state đã được debounce, việc render/cập nhật style nội bộ của chính `ResizableBox` vẫn có thể gây lag/giật trong quá trình kéo thả trong layout grid phức tạp.
*   **Các bước tiếp theo/Tùy chọn:**
    *   **Tinh chỉnh Debounce:** Thử nghiệm với các độ trễ debounce khác nhau (ví dụ: 50ms, 150ms) trong `lambai.tsx`.
    *   **Xem xét "Thanh Ghost":** Nếu việc tinh chỉnh debounce không đủ, đánh giá lại việc triển khai một "thanh ghost" tùy chỉnh chỉ hiển thị chỉ báo trực quan trong khi kéo và chỉ cập nhật layout khi thả (yêu cầu tái cấu trúc đáng kể việc xử lý resize).
    *   **Phân tích sâu bằng Profiling:** Sử dụng các công cụ hiệu năng của trình duyệt (tab Performance, React Profiler) *trong khi* kéo resize để xác định chính xác nút thắt cổ chai (ví dụ: tính toán lại style cụ thể, re-render component mặc dù đã memoization).

### Lag khi Gõ (Đã giải quyết?)

*   **Hành động đã thực hiện:** Đã triển khai debounce 500ms cho các cập nhật `OnChangePlugin` trong `AnswerArea.tsx`.
*   **Trạng thái:** Người dùng báo cáo cải thiện đáng kể. Tạm thời đánh dấu là đã giải quyết, nhưng cần theo dõi thêm trong quá trình kiểm thử.

## Sửa lỗi

### Hiển thị MathLive ban đầu

*   **Vấn đề ban đầu:** Component MathLive (`<math-field>`) không xuất hiện khi được kích hoạt (`!!`, Ctrl+Q).
*   **Sửa lỗi tạm thời:** Đã bình luận (comment out) các class `overflow: hidden` trong `lambai.tsx` (container grid và panel bên phải). Điều này cho phép MathLive xuất hiện.
*   **Công việc còn lại:** Tìm giải pháp CSS vĩnh viễn. `overflow: hidden` có thể đã được dùng để quản lý việc cuộn. Cần khôi phục chức năng cuộn mà không cắt xén ô nhập MathLive.
*   **Giải pháp khả thi:**
    *   **CSS Positioning/Z-index:** Điều chỉnh `z-index` hoặc positioning của container MathLive (`QuestionEditorInstance.tsx`) hoặc các thành phần cha của nó.
    *   **React Portal:** Render ô nhập MathLive bằng React Portal bên ngoài ngữ cảnh overflow của layout chính, trong khi vẫn duy trì kết nối state.
    *   **Tái cấu trúc Layout:** Điều chỉnh nhẹ cấu trúc grid/panel trong `lambai.tsx` để tránh sự kết hợp `overflow: hidden` có vấn đề.

## Dọn dẹp Code

*   **Công việc:** Xóa các chỉ thị `eslint-disable` không sử dụng được xác định bởi linter trong các tệp khác nhau (`route.ts`, `handler.ts`, `LatexPlugin.tsx`, `Selection.tsx`).

## Khó khăn chung/Bối cảnh

*   **Độ phức tạp của Layout:** Cấu trúc lồng nhau với CSS Grid, `ResizableBox`, positioning tuyệt đối và nhiều thuộc tính `overflow` làm cho việc gỡ lỗi CSS/layout trở nên khó khăn.
*   **Quản lý State:** Việc phối hợp state giữa các instance trình soạn thảo Lexical, `useMathLiveManager` dùng chung và component cha `AnswerArea`/`lambai.tsx` đòi hỏi việc truyền prop (prop drilling) và memoization cẩn thận.
*   **Thư viện bên ngoài:** Quản lý tương tác và xung đột tiềm ẩn giữa Lexical, MathLive (`<math-field>`) và `react-resizable`.
*   **Không gây lỗi hồi quy:** Đảm bảo các tối ưu hóa hiệu năng và sửa lỗi không ảnh hưởng tiêu cực đến các tính năng hiện có của trình soạn thảo hoặc hệ thống nộp bài quan trọng.